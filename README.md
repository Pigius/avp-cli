# AVP CLI Tool

This is a command-line interface (CLI) tool designed to interact with the AWS Verified Permissions (AVP) service. You can use it to create, manage, and delete policy stores, schemas, and policies.

## Big Picture

The AWS Verified Permissions (AVP) service is a powerful tool for managing permissions across your AWS resources. However, not everyone prefers to interact with it through the AWS console. Some developers prefer to quickly prototype and check something using a command-line interface, which can be faster and more flexible. This tool is designed to meet that need.

This tool is intended for learning and prototyping. It provides a quick and easy way to interact with the AVP service, allowing you to create, manage, and delete policy stores, schemas, and policies. However, it's not intended for production workloads.

## Prerequisites

Before you can use this tool, you need to set up your AWS credentials on your local machine. If you're using a MacBook, you can do this by adding the following to your `~/.aws/credentials` file:

```
[default]
aws_access_key_id=YOUR_ACCESS_KEY
aws_secret_access_key=YOUR_SECRET_ACCESS_KEY
region=eu-west-1 // or any other region
```

If you want to use a specific profile, you can add it like this:

```
[personal]
aws_access_key_id=YOUR_ACCESS_KEY
aws_secret_access_key=YOUR_SECRET_ACCESS_KEY
region=eu-west-1 // or any other region
```

Then, you can use the tool with the specific profile by running:

```
AWS_PROFILE=personal node index.js
```

```bash
➜  avp-cli git:(main) ✗ AWS_PROFILE=personal node index.js
Welcome to AVP CLI!
This tool is designed to help you interact with the AWS Verified Permissions (AVP) service. You can use it to create, manage, and delete policy stores, schemas, and policies.
Please ensure that you have set up your AWS credentials correctly to use this tool.
? What would you like to do? (Use arrow keys)
❯ List all policy stores
  Create a policy store
  Get a policy store
  Delete a policy store
  Add Schema to a policy store
  Add Static Policy
  Update Static Policy
(Move up and down to reveal more choices)
```

## Usage

The tool provides the following actions:

- List all policy stores
- Create a policy store
- Get a policy store
- Delete a policy store
- Add a schema to a policy store
- Add a static policy
- Update a static policy
- Get a policy
- Get a schema
- Delete a policy
- List all policies in a policy store

When you run the tool, it will prompt you to choose an action and then ask for any necessary additional information. Right now AVP does not support naming of the policy stores, so it's autogenerated. Soon it should be improved.

You can run it via:

```bash
node index.js
```

## Testing

You can test the tool by running it and choosing an action. For example, you could add a schema to a policy store by choosing the "Add Schema to a policy store" action and then providing the path to a JSON file containing the schema.

Here's an example of a schema:

```json
{
  "EcommercePlatform": {
    "entityTypes": {
      "CustomerGroup": {
        "shape": {
          "type": "Record",
          "attributes": {
            "name": {
              "type": "String",
              "required": true
            }
          }
        }
      },
      "Product": {
        "shape": {
          "type": "Record",
          "attributes": {}
        }
      },
      "Customer": {
        "shape": {
          "attributes": {},
          "type": "Record"
        },
        "memberOfTypes": ["CustomerGroup"]
      }
    },
    "actions": {
      "Create": {
        "appliesTo": {
          "principalTypes": ["Customer"],
          "resourceTypes": ["Product"]
        }
      },
      "Edit": {
        "appliesTo": {
          "context": {
            "attributes": {},
            "type": "Record"
          },
          "principalTypes": ["Customer", "CustomerGroup"],
          "resourceTypes": ["Product"]
        }
      },
      "View": {
        "appliesTo": {
          "context": {
            "type": "Record",
            "attributes": {
              "region": {
                "name": "region",
                "type": "String",
                "required": true
              }
            }
          },
          "principalTypes": ["Customer"],
          "resourceTypes": ["Product"]
        }
      },
      "Delete": {
        "appliesTo": {
          "resourceTypes": ["Product"],
          "principalTypes": ["Customer"]
        }
      }
    }
  }
}
```

And here's an example of a policy:

```txt
permit (
    principal,
    action in [EcommercePlatform::Action::"Edit"],
    resource
);
```

You can create files with these contents and then provide the paths to these files when prompted by the tool.

## Next Steps

I'm planning to continue improving this tool. Here are some of the next steps I am considering:

- **Prepared Scenarios**: I'm planning to add prepared scenarios that you can deploy within AWS. This will make it easier to get started with the tool and learn how to use the AVP service.

- **Better Error Handling**: I'm planning to improve the error handling in the tool to make it more robust and user-friendly.

- **Logging**: I'm considering adding logging to the tool to help you understand what's happening behind the scenes.

- **Configuration**: I'm planning to add more configuration options to the tool, allowing you to customize its behavior to better suit your needs.

- **Help Command**: I'm considering adding a help command that provides information about how to use the tool and what each command does.

- **Policy Templates**: I'm planning to add policy templates to the tool, making it easier to create new policies.

Stay tuned for these and other improvements!
